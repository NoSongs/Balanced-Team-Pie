<!DOCTYPE html>
<head>
	<meta charset="utf-8" />
	<!-- Set the viewport width to device width for mobile -->
	<meta name="viewport" content="width=device-width" />
	
	<title>Balanced Team Pie - LUXr</title>
  
	<!-- Included CSS Files -->
	<link rel="stylesheet" href="css/jockstrap.css">

	<!--[if lt IE 9]>
		<link rel="stylesheet" href="css/ie.css">
	<![endif]-->

	
	<!-- IE Fix for HTML5 Tags -->
	<!--[if lt IE 9]>
		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js">
        </script>
    <script type="text/javascript" src="js/d3.js"></script>
    <script type="text/javascript" src="js/d3.layout.js"></script>

    <script type="text/javascript" src="js/underscore-min.js"></script>
    <script type="text/javascript" src="js/simperium.js"></script>

    <style type="text/css">
    .team-select {
        cursor: pointer;
    }
    </style>
</head>
<body>
<div class="container">
	<div class="page container-small cell" id="start-page">
		<div class="content">
			<div class="row">
				<div class="span4">
					<div class="clearfix"><input id="company-name" class="span4" placeholder="Company or Project Name" type="text"></input></div>
				</div>	
			</div>
			<br />
			<div class="row">
				<h3>Choose Your Team's Project Type:</h3>
				<div class="team-select">
					<h4>Tech Startup</h4>
				</div>
				<div class="team-select">
					<h4>Circus Act</h4>
				</div>
				<div class="team-select">
					<h4>Santa's Workshop</h4>
				</div>
			</div>
			<br />
			<div class="row">
				<div class="next" style="display:none;">
					<a href="javascript: void(0);" class="btn large primary">Next</a>
				</div>
			</div>
		</div>
	</div>
        <script>
        $(document).ready(function(){
            var team_select_background = $('.team-select').css('background-color');
            var company_name, team_type;
            function show_next() {
                $('.next').show();
            }
            $('.team-select').click(function(){
                $('.team-select').css('background-color', team_select_background);
                $(this).css('background-color', 'yellow');
                show_next();
            });
            $('.next a').click(function(){
                $('.page').hide();
                $('#code-page').show();
                $('.company-name').html($('#company-name').val());
            });
        });
        </script>
    </div><!-- start-page -->

    <div class="page" id="code-page" style="display:none;">
        Congratulations!  You've created a new Balanced Team Pie for <span
        class="company-name">Foo</span>

        <br/>
        <br/>

        Give you team members this access code so they can connection:
        
        <br/>
        <br/>

        X 9 L o

        <br/>
        <br/>

        <div class="begin">
        <a href="javascript: void(0);">Begin</a>
        </div>
    </div><!-- code page-->


    <!-- vote page-->
    <script id="tpl-vote-page-option" type="text/x-jquery-tmpl">
        {{each options}}
        <div>
            ${$value}
            <input type="radio" name="category-${$index}" value="0" />0
            <input type="radio" name="category-${$index}" value="1" />1
            <input type="radio" name="category-${$index}" value="2" />2
            <input type="radio" name="category-${$index}" value="3" />3
            <input type="radio" name="category-${$index}" value="4" />4
        </div>
        {{/each}}
    </script>
    <div class="page" id="vote-page" style="display:none">
        How are you called?
        <br/>
        <input id="member-name" type="text"></input>
        <br/>
        <br/>
        How would you rate you ability in these areas?
        <br/>
        <br/>
        <div class="options">
        </div>
        <br/>
        <br/>
        <div class="results">
        <a href="javascript: void(0);">See Results</a>
        </div>
    </div><!-- vote page-->


    <div class="page" id="pie-page" style="display:none;">
        <a style="position:absolute; margin-left:10px; margin-top:20px"
            href="javascript: void(0);" class="btn primary go-vote">Change your scores</a>
        <div id="the-pie">
        </div>
    </div><!-- pie page-->

</div>

<script>
$(document).ready(function(){

    SIMPERIUM_OPTS = {
        host        : 'apiotra.simperium.com',
        port        : '80',
        token       : '991a75556cc14e4b8b556d8cb67feb55'
    };

    var bucket = new Simperium('app-society-569', 'Klmo', SIMPERIUM_OPTS);
    bucket.set_get_data(get_data);
    bucket.set_notify(notify);
    bucket.initialize_client();
    bucket.start();

    function get_data(id) {
        return null;
    }
    function notify(id, data) {
        console.log(id);
        console.log(data);
    }

    var options = [
        "Juggling",
        "Mini car driving",
        "Tightrope walking",
        "Lion taming",
        "Fire breathing",
        "Curiously deformed",
        "Knife throwing",
        "Knife target",
        ];

    $('.begin a').click(function(){
        $('.page').hide();
        $('#vote-page').show();
        $('#vote-page').show();
        $( "#tpl-vote-page-option" ).tmpl({options:options}).appendTo(".options");
    });

    $('.results a').click(function(){
        var choices = [];
        for(var i=0; i<=8; i++) {
            choices[choices.length] = $('input[name=category-'+i+']:checked').val();
        }
        draw_pie(options, choices);
        console.log(choices);
        $('.page').hide();
        $('#pie-page').show();
    });

    $('.go-vote').click(function(){
        $('.page').hide();
        $('#vote-page').show();
    });

    function draw_pie(options, choices) {
        var slice_spacing = .00;
        var w = 450,
            h = 450,
            r = Math.min(w, h) / 2,
            color = d3.scale.category20(),
            donut = d3.layout.pie(),
            arc = d3.svg.arc().innerRadius(r * .90).outerRadius(r);

        $("#the-pie").html('');
        var vis = d3.select("#the-pie")
          .append("svg:svg")
            .data([options])
            .attr("width", 600)
            .attr("height", 600);

        var arcs = vis.selectAll("g.arc")
            .data(donut)
          .enter().append("svg:g")
            .attr("class", "arc")
            .attr("transform", function(d,i) {
                var xoffset = r+100;
                var yoffset = r+20;
                xoffset += 5 * Math.sin((i+.5)*((Math.PI*2)/8));
                yoffset += -5 * Math.cos((i+.5)*((Math.PI*2)/8));
                return "translate(" + xoffset + "," + yoffset + ")";
            });

        arcs.append("svg:path")
            .attr("fill", function(d, i) { return '#000'; })
            .attr("id", function(d, i) { return "slice-" + i })
            .attr("d", function(d, i) {
                var a = ((Math.PI*2)/8);
                return arc
                    .startAngle((i*a)+slice_spacing)
                    .endAngle(((i+1)*a) -slice_spacing)
                    ();
                });
        arcs.append("svg:text")
            .attr("fill", "#FFF")
            .attr("dy", "1.0em")
            .attr("text-anchor", "middle")
                .append("svg:textPath")
                    .attr("xlink:href", function(d,i) { return "#slice-" + i; })
                    .attr("startOffset", "22%")
                    .text(function(d, i) { return options[i]; });

        for(var level=4; level>0; level--) {
            var offset = -.2 + (level*.2)
            var depth = .18 + offset;
            if(level==4) depth += .1;
            arcs.append("svg:path")
                .attr("fill", function(d, i) { return '#000'; })
                .attr("fill-opacity", 0.3)
                .attr("d", function(d, i) {
                    if(choices[i] >= level) {
                        var a = ((Math.PI*2)/8);
                        return d3.svg.arc()
                            .innerRadius(r * offset)
                            .outerRadius(r * depth)
                            .startAngle((i*a)+slice_spacing)
                            .endAngle(((i+1)*a) -slice_spacing)
                            ();
                    }
                });
        }
    } // end draw pie
    // choices = [3,2,1,4,0,2,3,4];
    // draw_pie(options, choices);
});
</script>

</body>
</html>
